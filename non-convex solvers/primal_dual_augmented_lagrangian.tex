\documentclass[10pt]{article}

% The preceding line is only needed to identify funding in the first footnote. If that is unneeded, please comment it out.
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{algorithmic}
\usepackage{graphicx}
\usepackage{textcomp}
\usepackage{xcolor}
\usepackage{mathtools}
\usepackage[short]{optidef}
\usepackage[paper=letterpaper,top=50pt,bottom=50pt,rmargin=50pt,lmargin=50pt]{geometry}

\setcounter{MaxMatrixCols}{25}

\begin{document}

\title{Primal-dual augmented-Lagrangian barrier solver for non-convex optimization}

\author{Taylor Howell}


\maketitle

\newpage
\section*{Background}
\subsection*{Optimization problem}
	\begin{mini*}
		{x}{f(x)}{}{}
		\addConstraint{c(x) = 0}
		\addConstraint{x_L \leq x \leq x_U}
	\end{mini*}

\subsection*{Barrier problem}
	\begin{mini*}
		{x}{\varphi(x; \mu) \coloneqq f(x) - \mu \sum_{i \in I_L} \text{log}(x^{(i)} - x^{(i)}_L) - \mu \sum_{i \in I_U} \text{log}(x^{(i)}_U - x^{(i)})}{}{}
		\addConstraint{c(x) = 0}
	\end{mini*}

\newpage
\section*{Formulation}
\subsection*{Problem with split constraint set}
\begin{mini*}
	{x}{f(x)}{}{}
	\addConstraint{c_{\mathcal I}(x) \geq 0}
	\addConstraint{c_{\mathcal E}(x) = 0}
	\addConstraint{c_{\mathcal A}(x) = 0}
	\addConstraint{x_L \leq x \leq x_U}
\end{mini*}

\subsection*{Slack reformulation for inequality constraints}
\begin{mini*}
	{x,s}{f(x)}{}{}
	\addConstraint{c_{\mathcal I}(x) - s = 0}
	\addConstraint{c_{\mathcal E}(x) = 0}
	\addConstraint{c_{\mathcal A}(x) = 0}
	\addConstraint{x_L \leq x \leq x_U}
	\addConstraint{s \geq 0}
\end{mini*}

\subsection*{Barrier problem}
\begin{mini*}
	{x,s}{\varphi(x,s; \mu)}{}{}
	\addConstraint{c_{\mathcal I}(x) - s = 0}
	\addConstraint{c_{\mathcal E}(x) = 0}
	\addConstraint{c_{\mathcal A}(x) = 0}
	\addConstraint{(x_L \leq x \leq x_U,\, s \geq 0)}
\end{mini*}

\begin{equation}
\begin{aligned}
\varphi(x,s; \mu) \coloneqq f(x) - \mu \sum_{i \in I_L} \text{log}(x^{(i)} - x^{(i)}_L) - \mu \sum_{i \in I_U} \text{log}(x^{(i)}_U - x^{(i)}) -\mu \sum_{i \in \mathcal I} \text{log}(s^{(i)})\notag
\end{aligned}
\end{equation}

\subsection*{Barrier problem with damping}
\begin{mini*}
	{x,s}{\varphi(x,s; \mu)}{}{}
	\addConstraint{c_{\mathcal I}(x) - s = 0}
	\addConstraint{c_{\mathcal E}(x) = 0}
	\addConstraint{c_{\mathcal A}(x) = 0}
	\addConstraint{(x_L \leq x \leq x_U,\, s \geq 0)}
\end{mini*}

\begin{equation}
	\begin{aligned}
	\varphi(x,s; \mu) \coloneqq f(x) &- \mu \sum_{i \in I_L} \text{log}(x^{(i)} - x^{(i)}_L) - \mu \sum_{i \in I_U} \text{log}(x^{(i)}_U - x^{(i)}) -\mu \sum_{i \in \mathcal I} \text{log}(s^{(i)}) \\
	& + \mu\kappa_D \sum_{i \in I_L \backslash I_U} (x^{(i)} - x^{(i)}_L)
	+ \mu\kappa_D \sum_{i \in I_U \backslash I_L} (x_U^{(i)} - x^{(i)})
	+ \mu\kappa_D \sum_{i \in \mathcal I} s^{(i)}\notag
	\end{aligned}
\end{equation}




\section*{augmented-Lagrangian barrier problem with slack reformulation}
	\begin{mini*}
		{x,s,r}{\varphi_{A}(x,s,r; \mu,\lambda,\rho)}{}{}
		\addConstraint{c_{\mathcal I}(x) - s = 0}
		\addConstraint{c_{\mathcal E}(x) = 0}
		\addConstraint{c_{\mathcal A}(x) - r = 0}
		\addConstraint{(x_L \leq x \leq x_U,\, s \geq s_L)}
	\end{mini*}

	\begin{equation}
		\begin{aligned}
		\varphi_{\mathcal A}(x,s,r; \mu,\lambda,\rho) \coloneqq f(x) &- \mu \sum_{i \in I_L} \text{log}(x^{(i)} - x^{(i)}_L) - \mu \sum_{i \in I_U} \text{log}(x^{(i)}_U - x^{(i)}) -\mu \sum_{i \in \mathcal I} \text{log}(s^{(i)} - s_L^{(i)}) \\
		& + \mu\kappa_D \sum_{i \in I_L \backslash I_U} (x^{(i)} - x^{(i)}_L)
		+ \mu\kappa_D \sum_{i \in I_U \backslash I_L} (x_U^{(i)} - x^{(i)})
		+ \mu\kappa_D \sum_{i \in \mathcal I} (s^{(i)} - s_L^{(i)})\\
		& + \lambda^T r + \frac{\rho}{2}r^T r \notag
		\end{aligned}
	\end{equation}
	
\subsection*{Primal-dual equations}
	\begin{equation}
		\begin{aligned}
			\nabla f(x) + \nabla c_{\mathcal I}(x)^T y_{\mathcal I} + \nabla c_{\mathcal E}(x)^T y_{\mathcal E} + \nabla c_{\mathcal A}(x)^T y_{\mathcal A} - z_L + z_U + \kappa_D \mu e_{L} - \kappa_D \mu e_{U} &= h_x = 0 \\
			-y_{\mathcal I} - z_s + \kappa_D \mu e_s &= h_s = 0\\
			r + \frac{1}{\rho}(\lambda - y_{\mathcal A}) &= h_r = 0 \\
			c_{\mathcal I}(x) - s &= h_{y_{\mathcal I}} = 0 \\
			c_{\mathcal E}(x) &= h_{y_{\mathcal E}} = 0 \\
			c_{\mathcal A}(x) -r &= h_{y_{\mathcal A}} = 0 \\
			X_L z_L - \mu e &= h_{z_L} = 0 \\
			S_Lz_s - \mu e &= h_{z_s} = 0 \\
			X_U z_U - \mu e &= h_{z_U} = 0 \\
			(x-x_L \geq 0,\,s -s_L \geq 0,\, x_U - x \geq 0,\, z_L \geq 0,\, z_U \geq 0)
		\end{aligned} \notag
	\end{equation}

	
	\subsection*{KKT system (full-space)}
	\begin{equation}
		\begin{aligned}
			\begin{bmatrix}
				W & 0 & 0 & \nabla c_{\mathcal I}^T & \nabla c_{\mathcal E}^T & \nabla c_{\mathcal A}^T & -I & 0 & I \\
				0 & 0 & 0 & -I & 0 & 0 & 0 & -I & 0 \\
				0 & 0 & I & 0 & 0 & -\frac{1}{\rho} I & 0 & 0 & 0\\
				\nabla c_{\mathcal I} & -I & 0 & 0 & 0 & 0 & 0 & 0 & 0\\
				\nabla c_{\mathcal E} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\
				\nabla c_{\mathcal A} & 0 & -I & 0 & 0 & 0 & 0 & 0 & 0\\
				Z_L & 0 & 0 & 0 & 0 & 0 & X_L & 0 & 0 \\
				0 & Z_S & 0 & 0 & 0 & 0 & 0 & S_L & 0 \\
				-Z_U & 0 & 0 & 0 & 0 & 0 & 0 & 0 & X_U\\
			\end{bmatrix}
			\begin{bmatrix}
				dx \\
				ds \\
				dr \\
				dy_{\mathcal I} \\
				dy_{\mathcal E} \\
				dy_{\mathcal A} \\
				dz_L \\
				dz_s \\
				dz_U \\
			\end{bmatrix}
			=
			-\begin{bmatrix}
				h_x \\
				h_s \\
				h_r \\
				h_{y_{\mathcal I}} \\
				h_{y_{\mathcal E}} \\
				h_{y_{\mathcal A}} \\
				h_{z_L} \\
				h_{z_s} \\
				h_{z_U} \\
			\end{bmatrix}
		\end{aligned} \notag
	\end{equation}
	 
	$ W(x,y_{\mathcal I},y_{\mathcal E},y_{\mathcal A}) = \nabla^2 f(x) + \sum_{i = 1}^{m_{\mathcal I}} y_{\mathcal I}^{(i)} \nabla^2 c_{\mathcal I}(x) + \sum_{i = 1}^{m_{\mathcal E}} y_{\mathcal E}^{(i)} \nabla^2 c_{\mathcal E}(x) + \sum_{i = 1}^{m_{\mathcal A}} y_{\mathcal A}^{(i)} \nabla^2 c_{\mathcal A}(x)$
	
	\subsection*{symmetric KKT system (reduced-space)}
	\begin{equation}
	\begin{aligned}
		\begin{bmatrix}
		\bar{W} & \nabla c_{\mathcal I}^T & \nabla c_{\mathcal E}^T & \nabla c_{\mathcal A}^T \\
		\nabla c_{\mathcal I} & -Z_s^{-1}S_L & 0 & 0 \\
		\nabla c_{\mathcal E} & 0 & 0 & 0 \\
		\nabla c_{\mathcal A} & 0 & 0 &-\frac{1}{\rho}I \\
		\end{bmatrix}
		\begin{bmatrix}
		dx \\
		dy_{\mathcal I} \\
		dy_{\mathcal E} \\
		dy_{\mathcal A} \\
		\end{bmatrix}
		=
		-\begin{bmatrix}
		h_x + X_L^{-1}h_{z_L} - X_U^{-1} h_{z_U}\\
		h_{y_{\mathcal I}} + Z_s^{-1}(S_L h_s + h_{z_s})\\
		h_{y_{\mathcal E}} \\
		h_{y_{\mathcal A}} + h_r\\
		\end{bmatrix}
	\end{aligned} \notag
	\end{equation}
	
	$\bar{W}(x,y_{\mathcal I},y_{\mathcal E},y_{\mathcal A}) = W(x,y_{\mathcal I},y_{\mathcal E},y_{\mathcal A}) + X_L^{-1}Z_L + X_U^{-1}Z_U $
	\\
	\begin{equation}
	\begin{aligned}
		dr &= \frac{1}{\rho} dy_{\mathcal A} - h_r\\
		dz_L &= -X_L^{-1}Z_L dx - X_L^{-1} h_{z_L}\\
		dz_U &= X_U^{-1}Z_U dx - X_U^{-1} h_{z_U}\\
		dz_s &= -dy_{\mathcal I} + h_s\\
		ds &= -Z_s^{-1}S_L dz_s - Z_s^{-1} h_{z_s}\\ \notag
	\end{aligned}
	\end{equation}
	
	\newpage
	\section*{Restoration phase}
	\subsection*{Formulation}
	\subsection*{KKT system (full-space)}
		\begin{equation}
		\begin{aligned}
		\begin{bmatrix}
			W & \nabla c_{\mathcal I}^T & \nabla c_{\mathcal E}^T & \nabla c_{\mathcal A}^T & -I & I & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\
			\nabla c_{\mathcal I} & 0 & 0 & 0 & 0 & 0 & -I & 0 & 0 & -I & 0 & 0 & I & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\
			\nabla c_{\mathcal E} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -I & 0 & 0 & I & 0 & 0 & 0 & 0 & 0 & 0 & 0\\
			\nabla c_{\mathcal A} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -I & 0 & 0 & -I & 0 & 0 & I & 0 & 0 & 0 & 0 & 0 & 0\\
			Z_L & 0 & 0 & 0 & X_L & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\
			-Z_U & 0 & 0 & 0 & 0 & X_U & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\
			0 & -I & 0 & 0 & 0 & 0 & 0 & -I & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\
			0 & 0 & 0 & 0 & 0 & 0 & Zs & S & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\
			0 & 0 & 0 & -\frac{1}{\rho}I & 0 & 0 & 0 & 0 & I & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\
			0 & -I & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -I & 0 & 0 & 0 & 0 & 0\\
			0 & 0 & -I & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -I & 0 & 0 & 0 & 0\\
			0 & 0 & 0 & -I & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -I & 0 & 0 & 0\\
			0 & I & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -I & 0 & 0\\
			0 & 0 & I & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -I & 0\\
			0 & 0 & 0 & I & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & -I\\
			0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & Z_{p_{\mathcal I}} & 0 & 0 & 0 & 0 & 0 & P_{\mathcal I} & 0 & 0 & 0 & 0 & 0\\
			0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & Z_{p_{\mathcal E}} & 0 & 0 & 0 & 0 & 0 & P_{\mathcal E} & 0 & 0 & 0 & 0\\
			0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & Z_{p_{\mathcal A}} & 0 & 0 & 0 & 0 & 0 & P_{\mathcal A} & 0 & 0 & 0\\
			0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & Z_{n_{\mathcal I}} & 0 & 0 & 0 & 0 & 0 & N_{\mathcal I} & 0 & 0\\
			0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & Z_{n_{\mathcal E}} & 0 & 0 & 0 & 0 & 0 & N_{\mathcal E} & 0\\
			0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & Z_{n_{\mathcal A}} & 0 & 0 & 0 & 0 & 0 & N_{\mathcal A}\\
		\end{bmatrix}
		\begin{bmatrix}
		dx \\
		dy_{\mathcal I} \\
		dy_{\mathcal E} \\
		dy_{\mathcal A} \\
		dz_L \\
		dz_U \\
		ds \\
		dz_s \\
		dr \\
		dp_{\mathcal I} \\
		dp_{\mathcal E} \\
		dp_{\mathcal A} \\
		dn_{\mathcal I} \\
		dn_{\mathcal E} \\
		dn_{\mathcal A} \\
		dz_{p_{\mathcal I}} \\
		dz_{p_{\mathcal E}} \\
		dz_{p_{\mathcal A}} \\
		dz_{n_{\mathcal I}} \\
		dz_{n_{\mathcal E}} \\
		dz_{n_{\mathcal A}} \\
		\end{bmatrix}
		=
		-\begin{bmatrix}
		r_x \\
		r_{y_{\mathcal I}} \\
		r_{y_{\mathcal E}} \\
		r_{y_{\mathcal A}} \\
		r_{z_L} \\
		r_{z_U} \\
		r_s \\
		r_{z_s} \\
		r_r \\
		r_{p_{\mathcal I}} \\
		r_{p_{\mathcal E}} \\
		r_{p_{\mathcal A}} \\
		r_{n_{\mathcal I}} \\
		r_{n_{\mathcal E}} \\
		r_{n_{\mathcal A}} \\
		r_{zp_{\mathcal I}} \\
		r_{zp_{\mathcal E}} \\
		r_{zp_{\mathcal A}} \\
		r_{zn_{\mathcal I}} \\
		r_{zn_{\mathcal E}} \\
		r_{zn_{\mathcal A}} \\
		\end{bmatrix}
		\end{aligned} \notag
	\end{equation}
	
		\subsection*{symmetric KKT system (reduced-space)}
	\begin{equation}
		\begin{aligned}
		\begin{bmatrix}
		\bar{W} & \nabla c_{\mathcal I}^T & \nabla c_{\mathcal E}^T & \nabla c_{\mathcal A}^T \\
		\nabla c_{\mathcal I} & \Sigma_{\mathcal I} & 0 & 0 \\
		\nabla c_{\mathcal E} & 0 & \Sigma_{\mathcal E} & 0 \\
		\nabla c_{\mathcal A} & 0 & 0 & \Sigma_{\mathcal A} \\
		\end{bmatrix}
		\begin{bmatrix}
		dx \\
		dy_{\mathcal I} \\
		dy_{\mathcal E} \\
		dy_{\mathcal A} \\
		\end{bmatrix}
		=
		-\begin{bmatrix}
		r_x + X_L^{-1}r_{z_L} - X_U^{-1} r_{z_U}\\
		r_{y_{\mathcal I}} + Z_s^{-1}(Sr_s + r_{z_s}) + Z_{p_{\mathcal I}}^{-1}(P_{\mathcal I}r_{p_{\mathcal I}} + r_{zp_{\mathcal I}}) - Z_{n_{\mathcal I}}^{-1}(N_{\mathcal I}r_{n_{\mathcal I}} + r_{zn_{\mathcal I}})\\
		r_{y_{\mathcal E}} + Z_{p_{\mathcal E}}^{-1}(P_{\mathcal E}r_{p_{\mathcal E}} + r_{zp_{\mathcal E}}) - Z_{n_{\mathcal E}}^{-1}(N_{\mathcal E}r_{n_{\mathcal E}} + r_{zn_{\mathcal E}})\\
		r_{y_{\mathcal A}} + r_r + Z_{p_{\mathcal A}}^{-1}(P_{\mathcal A}r_{p_{\mathcal A}} + r_{zp_{\mathcal A}}) - Z_{n_{\mathcal A}}^{-1}(N_{\mathcal A}r_{n_{\mathcal A}} + r_{zn_{\mathcal A}})\\
		\end{bmatrix}
		\end{aligned} \notag
	\end{equation}
	
	\begin{equation}
		\begin{aligned}
		\Sigma_{\mathcal I} &= -(Z_s^{-1} s + Z_{p_{\mathcal I}}^{-1} p_{\mathcal I} - Z_{n_{\mathcal I}}^{-1} n_{\mathcal I})\\
		\Sigma_{\mathcal E} &= -(Z_{p_{\mathcal E}}^{-1} p_{\mathcal E} - Z_{n_{\mathcal E}}^{-1} n_{\mathcal E})\\
		\Sigma_{\mathcal A} &= -(Z_{p_{\mathcal A}}^{-1} p_{\mathcal A} - Z_{n_{\mathcal A}}^{-1} n_{\mathcal A} + \frac{1}{\rho}I)\\ \notag
		\end{aligned}
	\end{equation}
	
	
	\begin{equation}
		\begin{aligned}
		dr &= \frac{1}{\rho} dy_{\mathcal A} - r_r\\
		dz_L &= -X_L^{-1}Z_L dx - X_L^{-1} r_{z_L}\\
		dz_U &= X_U^{-1}Z_U dx - X_U^{-1} r_{z_U}\\
		dz_s &= -dy_{\mathcal I} + r_s\\
		ds &= -Z_s^{-1}S dz_s - Z_s^{-1} r_{z_s}\\ 
		dz_p &= -dy + r_p \\
		dz_n &= dy + r_n \\
		dp &= Z_p^{-1}(-P dz_p - r_{z_p}) \\
		dn &= Z_n^{-1}(-N dz_n - r_{z_n}) \notag
		\end{aligned}
	\end{equation}
	
	
\end{document}
